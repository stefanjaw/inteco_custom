<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="crm_default_activities_stages_create" model="base.automation">
        <field name="name">CRM: Default activities by stage (Create)</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="trigger">on_create</field>
        <field name="active" eval="True"/>
        <field name="filter_domain">[('assigned_activity', '=', False)]</field>
        <field eval="10" name="sequence"/>
        <field name="state">code</field>
        <field name="code">
if record.stage_id:
    record.new_automatic_activity(record.stage_id.default_activities_ids)
        </field>
    </record>

    <record id="crm_default_activities_stages_write" model="base.automation">
        <field name="name">CRM: Default activities by stage (Write)</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="trigger">on_write</field>
        <field name="active" eval="True"/>
        <field name="filter_domain">[('assigned_activity', '=', False)]</field>
        <field eval="10" name="sequence"/>
        <field name="state">code</field>
        <field name="code">
if record.stage_id:
    record.new_automatic_activity(record.stage_id.default_activities_ids)
        </field>
    </record>

    <record id="template_default_code_automation" model="base.automation">
        <field name="name">Product: Internal Reference Update</field>
        <field name="model_id" ref="product.model_product_product"/>
        <field name="trigger">on_write</field>
        <field name="active" eval="True"/>
        <field eval="10" name="sequence"/>
        <field name="state">code</field>
        <field name="code">
variants = record.product_tmpl_id.product_variant_ids - record
if variants:
  variants._compute_default_code()
        </field>
    </record>
    <record id="crm_assign_leader_by_default" model="base.automation">
        <field name="name">CRM: Assign leader by default</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="trigger">on_create</field>
        <field name="active" eval="True"/>
        <field name="filter_domain">[('team_id','!=', False), ('user_id', '=', False)]</field>
        <field name="state">code</field>
        <field name="code">
if record.team_id.user_id:
    record.write({'user_id': record.team_id.user_id.id})
    for activity in record.activity_ids:
        activity.write({'user_id': record.team_id.user_id.id})
        </field>
    </record>
    <record id="crm_reassign_activity_owner" model="base.automation">
        <field name="name">CRM: Reassign activity owner</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="trigger">on_write</field>
        <field name="active" eval="True"/>
        <field name="filter_domain">[('assigned_activity','!=', False)]</field>
        <field name="state">code</field>
        <field name="code">
if record.user_id:
    record.activity_ids.write({'user_id': record.user_id.id})
        </field>
    </record>
    <record id="crm_do_lead_followers" model="base.automation">
        <field name="name">CRM: Additional followers for Dominican Republic leads</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="trigger">on_create</field>
        <field name="active" eval="True"/>
        <field name="state">code</field>
        <field name="code">
country = env['res.country'].browse(record.country_id.id)
if country.code == 'DO':
    domain = [('email', 'in', ['gtejera@inteco.org',])]
    follower_ids = env['res.users'].search(domain)
<!--    record.message_subscribe_users(follower_ids.ids)-->
        </field>
    </record>
    <record id="sale_order_followers" model="base.automation">
        <field name="name">Sale: Assign followers to a sale order</field>
        <field name="model_id" ref="sale.model_sale_order"/>
        <field name="trigger">on_create</field>
        <field name="active" eval="True"/>
        <field name="state">code</field>
        <field name="code">
if record.opportunity_id and record._context.get('add_followers'):
    opportunity = env['crm.lead'].browse(record.opportunity_id.id)
    record.message_subscribe(partner_ids=opportunity.message_partner_ids.ids)
        </field>
    </record>
</odoo>
